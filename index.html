<!DOCTYPE html>
<html>
<head>
  <title>CO2 Emissions Play Tool</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body {
      background: #000; margin: 0; padding: 20px;
      font-family: Arial, sans-serif; display: flex;
      justify-content: center; align-items: center; min-height: 100vh;
    }
    .container {
      width: 650px; padding: 15px; background: #1a1a1a;
      border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.5);
      display: flex; flex-direction: column;
    }
    .controls { display: flex; justify-content: space-around; margin-bottom: 10px; gap: 5px; }
    .control-group {
      background: linear-gradient(145deg, #2a2a2a, #333);
      padding: 8px; border-radius: 8px; box-shadow: inset 0 0 10px rgba(255,255,255,0.1); flex: 1;
    }
    .control-label { color: #fff; font-size: 12px; font-weight: bold; margin-bottom: 5px; text-shadow: 0 0 5px rgba(255,255,255,0.3); }
    .button-group { display: flex; gap: 4px; }
    .control-btn {
      padding: 4px 8px; border: none; border-radius: 4px;
      background: linear-gradient(145deg, #3a3a3a, #2a2a2a);
      color: #fff; cursor: pointer; transition: all .3s ease; flex: 1; font-size: 11px;
      box-shadow: inset 0 0 5px rgba(255,255,255,0.1), 0 2px 5px rgba(0,0,0,0.2);
    }
    .control-btn.active {
      background: linear-gradient(145deg, #4a4a4a, #3a3a3a);
      box-shadow: inset 0 0 10px rgba(255,255,255,0.2), 0 0 15px rgba(255,255,255,0.1);
      transform: scale(1.05);
    }
    #graph { height: 280px; background: #1a1a1a; border-radius: 8px; margin-bottom: 8px; }
    .info-panel {
      color: #00ff99; font-size: 13px; padding: 8px; background: rgba(0,0,0,0.3);
      border-radius: 5px; display: flex; justify-content: space-between; align-items: center;
      margin-top: 8px;
    }
    .emissions-info { flex: 1; padding-right: 10px; }
    .trees-info { flex: 1; text-align: right; }
  </style>
</head>
<body>
  <div class="container">
    <div class="controls">
      <div class="control-group">
        <div class="control-label">Traffic Level</div>
        <div class="button-group">
          <button class="control-btn active" data-traffic="low">Low</button>
          <button class="control-btn" data-traffic="mid">Mid</button>
          <button class="control-btn" data-traffic="high">High</button>
        </div>
      </div>
      <div class="control-group">
        <div class="control-label">Weather</div>
        <div class="button-group">
          <button class="control-btn active" data-weather="cool">Cool</button>
          <button class="control-btn" data-weather="moderate">Mod</button>
          <button class="control-btn" data-weather="hot">Hot</button>
        </div>
      </div>
      <div class="control-group">
        <div class="control-label">Vehicle Type</div>
        <div class="button-group">
          <button class="control-btn active" data-vehicle="motorcycle">Moto</button>
          <button class="control-btn" data-vehicle="scooter">Scooter</button>
          <button class="control-btn" data-vehicle="van">Van</button>
        </div>
      </div>
    </div>

    <div id="graph"></div>

    <!-- Tree Panel stays separate, always visible at the bottom -->
    <div class="info-panel">
      <div class="emissions-info" id="emissionsInfo"></div>
      <div class="trees-info" id="treesInfo"></div>
    </div>
  </div>

  <script>
    let currentTraffic = 'low';
    let currentWeather = 'cool';
    let currentVehicle = 'motorcycle';

    const trafficCurves = {
      low: (x) => Math.pow(x, 1.2),
      mid: (x) => Math.pow(x, 1.6),
      high: (x) => Math.pow(x, 2)
    };

    const weatherEffects = {
      cool: (x) => x,
      moderate: (x) => x * (1 + x/8),
      hot: (x) => x * (1 + x/4)
    };

    const vehicleBaseEmissions = {
      motorcycle: 75,
      scooter: 100,
      van: 200
    };

    function calculateEmissions(x) {
      const base = vehicleBaseEmissions[currentVehicle];
      const t = trafficCurves[currentTraffic](x);
      const w = weatherEffects[currentWeather](x);
      return base * (t/5) * (w/5);
    }

    function calculateTreeOffset(maxEmission) {
      const CO2_PER_TREE_PER_YEAR = 22;  // kg CO2 per tree per year
      const HOURS_PER_DAY = 8;
      const WORK_DAYS = 260;

      const annualCO2 = maxEmission * HOURS_PER_DAY * WORK_DAYS;

      return {
        peak: maxEmission.toFixed(1),
        annual: Math.round(annualCO2),
        trees: {
          fiveYear: Math.ceil(annualCO2 / CO2_PER_TREE_PER_YEAR),
          tenYear: Math.ceil(annualCO2 / (CO2_PER_TREE_PER_YEAR * 2)),
          twentyYear: Math.ceil(annualCO2 / (CO2_PER_TREE_PER_YEAR * 4))
        }
      };
    }

    function updateGraph() {
      const xValues = Array.from({ length: 101 }, (_, i) => i / 10);
      const yValues = xValues.map(calculateEmissions);
      const maxEmission = Math.max(...yValues);

      const legendText = [
        `Traffic: ${currentTraffic}`,
        `Weather: ${currentWeather}`,
        `Vehicle: ${currentVehicle}`
      ].join('<br>');

      const trace = {
        x: xValues,
        y: yValues,
        mode: 'lines',
        line: {
          color: currentVehicle === 'motorcycle' ? '#ff00ff' :
                 currentVehicle === 'scooter' ? '#00ffff' : '#00ff00',
          width: 3,
          shape: 'spline',
          smoothing: 1.2
        },
        name: legendText
      };

      const layout = {
        title: { text: 'COâ‚‚ Emissions (kg/hour)', font: { color: '#fff', size: 16 } },
        plot_bgcolor: '#1a1a1a',
        paper_bgcolor: '#1a1a1a',
        xaxis: {
          title: 'Time (hours)', gridcolor: '#333', color: '#fff',
          tickfont: { size: 10 }, range: [0, 10], dtick: 2
        },
        yaxis: {
          title: 'COâ‚‚ (kg)', gridcolor: '#333', color: '#fff',
          tickfont: { size: 10 }, range: [0, 500], dtick: 100
        },
        margin: { l: 60, r: 180, t: 50, b: 120 }, // big bottom margin for tree panel
        showlegend: true,
        legend: {
          orientation: 'v',
          x: 1.02,
          y: 1,
          xanchor: 'left',
          yanchor: 'top',
          font: { color: '#fff', size: 12 },
          bgcolor: 'rgba(0,0,0,0.55)',
          bordercolor: '#333',
          borderwidth: 1
        },
        width: 650,
        height: 280,
        autosize: false
      };

      Plotly.newPlot('graph', [trace], layout);

      const offset = calculateTreeOffset(maxEmission);
      document.getElementById('emissionsInfo').innerHTML =
        `Peak: ${offset.peak} kg COâ‚‚/hr | Annual: ${offset.annual} kg COâ‚‚`;
      document.getElementById('treesInfo').innerHTML =
        `ðŸŒ³ ${offset.trees.fiveYear} trees (5yr) | ${offset.trees.tenYear} trees (10yr) | ${offset.trees.twentyYear} trees (20yr)`;
    }

    document.querySelectorAll('.control-btn').forEach(btn => {
      btn.addEventListener('click', function () {
        this.parentElement.querySelectorAll('.control-btn').forEach(b => b.classList.remove('active'));
        this.classList.add('active');

        if (this.dataset.traffic) currentTraffic = this.dataset.traffic;
        if (this.dataset.weather) currentWeather = this.dataset.weather;
        if (this.dataset.vehicle) currentVehicle = this.dataset.vehicle;

        updateGraph();
      });
    });

    updateGraph();
  </script>
</body>
</html>
